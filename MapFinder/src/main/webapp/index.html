<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Finder</title>
    <link rel="icon" href="images/map_logo.png">
    <script>
     
    </script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
   <header>
        <nav>
            <img src="images/map_logo.png" alt="logo" class="logo" onclick="window.location.href='index.html'";>   
        <div>
            <h1>Map Finder</h1>
            <p>Explore Click Learn</p>
        </div>
        </nav>
       
        <button class="signupBtn" id="logout-btn">Log Out</button> 
   </header>
   <div class="container">
        <div class="learnMode">
            <img src="images/learn_logo.jpg" alt="learn_logo">
            <h2>Spot the State</h2>
            <button id="btn" onclick="playGame('learnMode')" style="background-color: orange;">Play</button>
        </div>
        <div class="quizMode">
            <br><br>
            <img src="images/quiz_logo.avif" alt="quiz_logo">
            <br>
            <h2>State Quizzer</h2>
            <button id="btn" style="background-color:#000080;" onclick="playGame('quizMode')">Play</button>
        </div>
        <div class="botMode">
            <img src="images/bot_logo.jpg" alt="bot_logo">
            <br><br>
            <h2>Battle the Bot</h2>
            <button id="btn" style="background-color: green;" onclick="playGame('botMode')">Play</button>
        </div>
        <div class="selfMode">
            <img src="images/self_eval_logo-removebg-preview.png" alt="">
            <h2>Practice Zone</h2>
            <button id="btn" onclick="playGame('selfMode')" style="background-color:orange; ">Play</button>
        </div>
        <div class="rectifyMode">
            <br>
            <img src="images/learn_mistakes_logo.jpg" alt="learn_mistakes_logo">
            <br><br>
            <h2>Retry Zone</h2>
            <button id="btn" onclick="playGame('rectifyMode')" style="background-color: #000080;">Play</button>
        </div>
        <div class="writeMode">
            <img src="images/write_mode.jpg" alt="write_mode_logo">
            <h2>State Speller</h2>
            <button id="btn" onclick="playGame('writeMode')" style="background-color: green ;">Play</button>
        </div>
   </div>
   <footer>
    <h2>Copyright &copy; 2025 SRIRAM-S &#174;</h2>
  </footer>
</body>    
    <script>
    
    document.addEventListener("visibilitychange", async function ()  {
        if (!document.hidden) {
        	let session= await isSessionExist();
        	if(session){
        		blockBackNavigation();
        	}
        	else{
        		console.log("triggering logout");
        		logout();
        	}
        }
    });
    
    async function isSessionExist(){
        try{
            let res=await fetch("/MapFinder/checksession");
            let msg=await res.text();

            if(msg==="failed"){
                localStorage.clear();
                console.log("session not exist");
                return false;
            }

            console.log("session exist");
            return true;

        } catch(err){
            console.log(err);
            return false;
        }
    }

    
    function change(uri){
    	window.location.replace(uri);
    }
    
    function blockBackNavigation(){
    	history.pushState(null, null, location.href);
    	 window.onpopstate = function () {
    	        history.go(1);
    	 };
    }
    	
   window.onload=async function(){
	   let session=await isSessionExist();
	   if(!session){
		   change("signin");
	   }
	   blockBackNavigation();
   }

    window.addEventListener("popstate", async (event) => {
    	console.log("clicking back button");
    	let session= await isSessionExist();
    	if(session){
        	console.log("session is alive");

    		blockBackNavigation();
    	}
    	else{
        	console.log("no session going to signin");

    		change("signin");
    	}
    });

		
		
    	document.querySelector("#logout-btn").addEventListener("click",()=>{
			logout();			
    	});
    	
    	function logout(){
    		console.log("log out...")
    		localStorage.clear();
    		fetch("/MapFinder/logout").then(res=>res.text())
    		.then((msg)=>{
    			
    				if(msg==="logout"){
    					console.log(msg);
    					window.location.replace("signin");
    				}
    			}).catch((err)=>console.log(err));
    	}
    	
        function playGame(gameType) {
            switch(gameType){
                case 'learnMode':
                    window.location.href="test_map.html";
                    break;
                case 'writeMode':
                    window.location.href="write_mode.html";
                    break;
                case 'rectifyMode':
                    window.location.href="rectify_mode.html";
                    break;
                case 'selfMode':
                    window.location.href="self_evaluate_mode.html";
                    break;
                case 'botMode':
                    window.location.href="botmode.html";
                    break;
                case 'quizMode':
                    window.location.href="quizmode.html";                   
            }
        }
    </script>
</body>
</html>